generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String                 @id @default(uuid()) @db.VarChar(36)
  userNo                String                 @unique() @db.VarChar(50)
  name                  String                 @db.VarChar(50)
  password              String                 @db.VarChar(100)
  email                 String?
  phone                 String?
  isAdmin               Boolean                @default(false)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  roles                 Role[]
  extraWorkApplications ExtraWorkApplication[] @relation("userExtraWorkApplications")

  @@map("user")
}

model Role {
  id          String   @id @default(uuid()) @db.VarChar(36)
  name        String   @unique() @db.VarChar(50)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       User[]
  menus       Menu[]

  @@map("role")
}

enum MenuType {
  Iframe
  View
  Group
  DynamicFormView
}

model Menu {
  id                String   @id @default(uuid()) @db.VarChar(36)
  name              String   @unique() @db.VarChar(50)
  type              MenuType
  routerPath        String?
  url               String?
  sort              Int?
  dynamicFormViewId String?  @db.VarChar(36)
  isEnabled         Boolean  @default(false)
  description       String?  @db.VarChar(255)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  roles             Role[]
  parentMenuId      String?
  parentMenu        Menu?    @relation("parentSubMenu", fields: [parentMenuId], references: [id])
  subMenus          Menu[]   @relation("parentSubMenu")

  @@map("menu")
}

model DynamicTable {
  id                  String                @id @default(uuid()) @db.VarChar(36)
  name                String                @unique() @db.VarChar(50)
  tableName           String                @db.VarChar(50)
  description         String?               @db.VarChar(255)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  cols                DynamicCol[]          @relation("tableCols")
  parentCols          DynamicCol[]          @relation("parentSubTableCols")
  dynamicFormViewComp DynamicFormViewComp[] @relation("dynamicFormViewCompTable")

  @@map("dynamic_table")
}

enum DynamicColType {
  String
  Boolean
  Int
  DateTime
  SubTable
  Enum
}

enum SubTableType {
  ToOne
  ToMany
}

enum SubTableWritableStrategy {
  ConnectById
  UpsertByObject
}

enum SubTableQueryStrategy {
  FullObject
  PartialObject
}

model DynamicCol {
  id          String         @id @default(uuid()) @db.VarChar(36)
  name        String         @db.VarChar(50)
  canWritable Boolean        @default(true)
  canQuery    Boolean        @default(true)
  colType     DynamicColType
  fission     Json?

  enumCategoryId String? @db.VarChar(36)

  subTableType             SubTableType?
  subTableWritableStrategy SubTableWritableStrategy?
  subTableQueryStrategy    SubTableQueryStrategy?

  description String?       @db.VarChar(255)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  subTable    DynamicTable? @relation("parentSubTableCols", fields: [subTableId], references: [id])
  subTableId  String?       @db.VarChar(36)
  table       DynamicTable  @relation("tableCols", onDelete: Cascade, fields: [tableId], references: [id])
  tableId     String        @db.VarChar(36)

  @@map("dynamic_col")
}

enum DynamicFormLabelPosition {
  left
  right
  top
}

model DynamicForm {
  id                  String                    @id @default(uuid()) @db.VarChar(36)
  name                String                    @db.VarChar(50)
  labelPosition       DynamicFormLabelPosition?
  beforeSubmit        String?                   @db.VarChar(255)
  defaultValue        String?                   @db.VarChar(255)
  // dynamicFormSchemas DynamicFormSchemas[] @relation("dynamicFormSchemas")
  schemas             Json
  description         String?                   @db.VarChar(255)
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  dynamicFormViewComp DynamicFormViewComp[]     @relation("dynamicFormViewCompForm")

  @@map("dynamic_form")
}

enum DynamicFormViewCompDataSourceType {
  DynamicTable
  // OtherTable
}

enum DynamicFormViewCompFormSourceType {
  DynamicForm
  // OtherForm
}

model DynamicFormViewComp {
  id           String   @id @default(uuid()) @db.VarChar(36)
  name         String   @db.VarChar(50)
  tableColumns Json
  description  String?  @db.VarChar(255)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  dataSourceType DynamicFormViewCompDataSourceType
  //TODO ： 此处仍需添加其他数据源配置，如分页，保存，获取等第三方数据源api
  dynamicTable   DynamicTable?                     @relation("dynamicFormViewCompTable", fields: [dynamicTableId], references: [id])
  dynamicTableId String?
  //TODO ： 此处仍需添加其他表单，如、第三方url，通过传入初始化数据及提交接口，实现表单获取保存
  formSourceType DynamicFormViewCompFormSourceType
  dynamicForm    DynamicForm?                      @relation("dynamicFormViewCompForm", fields: [dynamicFormId], references: [id])
  dynamicFormId  String?

  @@map("dynamic_form_view_comp")
}

enum ExtraWorkApplicationType {
  // 常规加班 
  Regular
  // 节假日加班
  Holiday
  // 紧急加班
  Emergency
  // 调休加班
  Compensatory
}

//TODO:加创建人修改人字段
model ExtraWorkApplication {
  id          String                   @id @default(uuid()) @db.VarChar(36)
  userId      String                   @db.VarChar(36)
  user        User?                    @relation("userExtraWorkApplications", fields: [userId], references: [id])
  type        ExtraWorkApplicationType
  startTime   DateTime
  endTime     DateTime
  description String?                  @db.VarChar(255)
  createdAt   DateTime                 @default(now())
  updatedAt   DateTime                 @updatedAt
  testId      String?                  @db.VarChar(36)

  @@map("extra_work_application")
}

model EnumCategory {
  id          String       @id @default(uuid()) @db.VarChar(36)
  name        String       @unique() @db.VarChar(50)
  title       String       @db.VarChar(50)
  details     EnumDetail[] @relation("enumCategoryDetails")
  description String?      @db.VarChar(255)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@map("enum_category")
}

model EnumDetail {
  id          String       @id @default(uuid()) @db.VarChar(36)
  name        String       @db.VarChar(100)
  value       String       @db.VarChar(100)
  description String?      @db.VarChar(255)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  categoryId  String       @db.VarChar(36)
  category    EnumCategory @relation("enumCategoryDetails", onDelete: Cascade, fields: [categoryId], references: [id])

  @@map("enum_detail")
}

model TextCollection {
  id          String   @id @default(uuid()) @db.VarChar(36)
  text        String   @db.VarChar(250)
  author      String?  @db.VarChar(50)
  source      String?  @db.VarChar(50)
  description String?  @db.VarChar(255)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("text_collection")
}
